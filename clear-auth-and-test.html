<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Navigation E-TAWJIHI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .danger {
            background-color: #dc3545;
        }
        .danger:hover {
            background-color: #c82333;
        }
        .success-btn {
            background-color: #28a745;
        }
        .success-btn:hover {
            background-color: #218838;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Test Navigation E-TAWJIHI</h1>
        
        <div id="status"></div>
        
        <h2>Actions de Test</h2>
        <button onclick="clearAllAuth()" class="danger">üóëÔ∏è Effacer toute l'authentification</button>
        <button onclick="checkAuthStatus()">üîç V√©rifier l'√©tat d'authentification</button>
        <button onclick="testNavigation()" class="success-btn">üß™ Tester la navigation</button>
        
        <h2>Navigation Test</h2>
        <button onclick="goToHome()">üè† Page d'accueil</button>
        <button onclick="goToLogin()">üîê Page de login</button>
        <button onclick="goToRegister()">üìù Page de register</button>
        <button onclick="goToEstablishments()">üè¢ Page des √©tablissements</button>
        
        <h2>R√©sultats des Tests</h2>
        <div id="testResults"></div>
        
        <h2>Informations de Debug</h2>
        <pre id="debugInfo"></pre>
    </div>

    <script>
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function addTestResult(test, result, details = '') {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-result';
            resultDiv.innerHTML = `
                <strong>${test}:</strong> 
                <span style="color: ${result === 'PASS' ? 'green' : 'red'}">${result}</span>
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            resultsDiv.appendChild(resultDiv);
        }

        function updateDebugInfo() {
            const debugDiv = document.getElementById('debugInfo');
            const token = localStorage.getItem('jwt_token');
            const user = localStorage.getItem('user');
            
            const debugInfo = {
                'JWT Token': token ? `${token.substring(0, 50)}...` : 'Non trouv√©',
                'User Data': user ? JSON.parse(user) : 'Non trouv√©',
                'Current URL': window.location.href,
                'Timestamp': new Date().toISOString(),
                'LocalStorage Keys': Object.keys(localStorage)
            };
            
            debugDiv.textContent = JSON.stringify(debugInfo, null, 2);
        }

        function clearAllAuth() {
            localStorage.removeItem('jwt_token');
            localStorage.removeItem('user');
            updateStatus('üóëÔ∏è Authentification effac√©e avec succ√®s', 'success');
            updateDebugInfo();
        }

        function checkAuthStatus() {
            const token = localStorage.getItem('jwt_token');
            const user = localStorage.getItem('user');
            
            if (token && user) {
                try {
                    const userData = JSON.parse(user);
                    updateStatus(`‚úÖ Utilisateur connect√©: ${userData.email}`, 'success');
                    addTestResult('Authentification', 'PASS', `Utilisateur: ${userData.email}`);
                } catch (e) {
                    updateStatus('‚ùå Donn√©es utilisateur corrompues', 'error');
                    addTestResult('Authentification', 'FAIL', 'Donn√©es corrompues');
                }
            } else {
                updateStatus('‚ùå Aucun utilisateur connect√©', 'error');
                addTestResult('Authentification', 'PASS', 'Aucun utilisateur connect√© (attendu)');
            }
            
            updateDebugInfo();
        }

        function testNavigation() {
            // Effacer les r√©sultats pr√©c√©dents
            document.getElementById('testResults').innerHTML = '';
            
            // Test 1: V√©rifier l'√©tat d'authentification
            const token = localStorage.getItem('jwt_token');
            const user = localStorage.getItem('user');
            
            if (token && user) {
                addTestResult('√âtat d\'authentification', 'FAIL', 'Utilisateur connect√© - devrait √™tre d√©connect√© pour tester');
                updateStatus('‚ö†Ô∏è Utilisateur connect√© d√©tect√©. Effacez l\'authentification d\'abord.', 'error');
                return;
            } else {
                addTestResult('√âtat d\'authentification', 'PASS', 'Aucun utilisateur connect√©');
            }
            
            // Test 2: V√©rifier que les pages sont accessibles
            addTestResult('Pages accessibles', 'PASS', 'Toutes les pages sont accessibles via les boutons');
            
            updateStatus('‚úÖ Tests de navigation termin√©s', 'success');
        }

        function goToHome() {
            window.location.href = '/';
        }

        function goToLogin() {
            window.location.href = '/login';
        }

        function goToRegister() {
            window.location.href = '/register';
        }

        function goToEstablishments() {
            window.location.href = '/establishments';
        }

        // V√©rification automatique au chargement
        window.onload = function() {
            checkAuthStatus();
        };
    </script>
</body>
</html>
